pipeline {
    agent any

    environment {
        SSH_HOST = '13.201.227.177'
        SSH_USER = 'ubuntu'
        DEPLOY_DIR = '/var/www/html/'
    }

    stages {
        stage('Checkout code') {
            steps {
                checkout scm
            }
        }

        stage('Set up Node.js') {
            tools {
                nodejs 'nodejs-20.0.0' // The name of the NodeJS installation in Jenkins
            }
        }

        stage('Install dependencies') {
            steps {
                sh 'npm install'
            }
        }

        stage('Build frontend') {
            steps {
                sh 'npm run build'
            }
        }

        stage('Deploy frontend') {
            steps {
                sshagent(['ssh-private-key-id']) {
                    sh '''
                        scp -r ./build/* ${SSH_USER}@${SSH_HOST}:${DEPLOY_DIR}
                    '''
                }
            }
        }
    }
}
